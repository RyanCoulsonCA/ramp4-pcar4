<template>
    <div class="h-full"></div>
</template>

<script lang="ts">
import { Vue, Watch, Component } from 'vue-property-decorator';
import { Get, Sync, Call } from 'vuex-pathify';
import GapiLoader, { Map, GeoApi, RampMapConfig } from 'ramp-geoapi';
// import { window } from '@/main';

import { ConfigStore } from '@/store/modules/config';
import { LayerStore, layer } from '@/store/modules/layer';
import BaseLayer from 'ramp-geoapi/dist/layer/BaseLayer';

@Component
export default class EsriMap extends Vue {
    @Get(ConfigStore.getMapConfig) mapConfig!: RampMapConfig;

    @Get(LayerStore.layers) layers!: BaseLayer[];

    gapi!: GeoApi;
    map!: Map;

    created() {
        console.log(this.layers);
    }

    @Watch('layers')
    onLayerArrayChange(newValue: BaseLayer[], oldValue: BaseLayer[]) {
        newValue.forEach(layer => {
            // TODO add a proper check for this after
            // if (!oldValue.includes(layer)) {
            this.map.addLayer(layer);
            // }
        });
    }

    @Watch('mapConfig')
    onMapConfigChange(newValue: RampMapConfig, oldValue: RampMapConfig) {
        if (newValue === oldValue) {
            return;
        }
        this.map = (window as any).RAMP.geoapi.maps.createMap(this.mapConfig, this.$el as HTMLDivElement);
        // FIXME: temporarily store map in global, remove line below when map API is complete
        this.$iApi.map = this.map;
        this.onLayerArrayChange(this.layers, []);
    }
}
</script>

<style lang="scss" scoped></style>
